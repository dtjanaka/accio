<form
  novalidate
  [formGroup]="uploadImageForm"
  (ngSubmit)="onSubmit()"
  *ngIf="displayUpload"
  id="upload-image-form"
  method="POST"
  enctype="multipart/form-data"
>
  <div style="width: 10%;">Upload an Image</div>

  <mat-form-field appearance="fill" class="user-input">
    <mat-label>Image Name</mat-label>
    <input required matInput formControlName="imgName" placeholder="Untitled" />
  </mat-form-field>

  <mat-form-field class="user-input" appearance="fill">

    <ngx-mat-file-input formControlName="image"> </ngx-mat-file-input>

    <mat-hint>Select an Image</mat-hint>
  </mat-form-field>

  <mat-form-field appearance="fill" class="user-input">
    <mat-label>Tags (Optional)</mat-label>
    <input matInput formControlName="tags" />
    <mat-hint>Enter list seperated by commas: "tag1, tag2, tag3"</mat-hint>
  </mat-form-field>

  <button type="submit" mat-raised-button id="upload-button">Upload Image</button>
</form>

<!--Filter Bar-->
<div class="form" style="background-color: #f5f5f5">
  <h1>Search by:</h1>
  <mat-form-field hintLabel="Clear to remove this filter" appearance="fill">
    <mat-label>Image Name</mat-label>
    <input matInput [(ngModel)]="imgName" placeholder="Ex. MyImage" />
  </mat-form-field>

  <mat-form-field hintLabel="Clear to remove this filter" appearance="fill">
    <mat-label>Mask Name</mat-label>
    <input matInput [(ngModel)]="maskName" placeholder="Ex. MyMask" />
  </mat-form-field>

  <mat-form-field hintLabel="Clear to remove this filter" appearance="fill">
    <mat-label>Filter Tag</mat-label>
    <input matInput [(ngModel)]="tag" placeholder="Ex. river" />
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Sort Images</mat-label>
    <mat-select [(ngModel)]="sortImg">
      <mat-option value="dsc">newest to oldest</mat-option>
      <mat-option value="asc">oldest to newest</mat-option>
    </mat-select>
    <mat-hint align="end">Default: newest</mat-hint>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Show masks for Image: {{ imgName }}</mat-label>
    <mat-select [(ngModel)]="withMasks">
      <mat-option value="false">Don't show masks</mat-option>
      <mat-option value="true">Show masks for: {{ imgName }}</mat-option>
    </mat-select>
    <mat-hint align="end">Default: no masks</mat-hint>
  </mat-form-field>

  <button mat-raised-button (click)="loadGalleryImages()">Update filter(s)</button>
</div>
<!--Filter Bar-->

<!--Project Download Bar-->
<div id="project-download-bar">
  <div id="project-download">
    <button
      mat-icon-button
      [matMenuTriggerFor]="menu1"
      aria-label="Project download menu"
    >
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu1="matMenu">
      <button mat-menu-item (click)="downloadProjectImages()">
        <mat-icon>folder</mat-icon>
        <span>Download project files</span>
      </button>
    </mat-menu>
  </div>
</div>
<!--Project Download Bar-->

<!--Fetched Images-->
<div class="gallery">
  <div *ngFor="let image of imageArray" class="gallery-item">
    <div>
      <a [routerLink]="['/editor', projectId, image['name'], image['url']]">
        <img class="gallery-img" [src]="image['url']" />
      </a>
    </div>
    <div class="gallery-item-name">
      <a [routerLink]="['/editor', projectId, image['name'], image['url']]">
        <p>{{ image["name"] }}</p>
      </a>
    </div>
    <div class="download">
      <button
        mat-icon-button
        [matMenuTriggerFor]="menu2"
        aria-label="Image download menu"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu2="matMenu">
        <button mat-menu-item (click)="downloadImage(image)">
          <mat-icon>image</mat-icon>
          <span>Download image</span>
        </button>
        <button mat-menu-item (click)="downloadImageAndItsMasks(image)">
          <mat-icon>photo_library</mat-icon>
          <span>Download image and masks</span>
        </button>
      </mat-menu>
    </div>
  </div>
</div>
<!--Fetched Images-->

<!--Fetched Masks-->
<div class="gallery">
  <ng-container *ngFor="let image of imageArray">
    <div *ngFor="let mask of image['masks']" class="gallery-item">
      <div>
        <a
          [routerLink]="[
            '/editor',
            projectId,
            mask['name'],
            mask['url'],
            image['name'],
            image['url']
          ]"
        >
          <img class="gallery-img" [src]="mask['url']" />
        </a>
      </div>
      <div class="gallery-item-name">
        <a
          [routerLink]="[
            '/editor',
            projectId,
            mask['name'],
            mask['url'],
            image['name'],
            image['url']
          ]"
        >
          <p>{{ mask["name"] }}</p>
        </a>
      </div>
      <div class="download">
        <button
          mat-icon-button
          [matMenuTriggerFor]="menu3"
          aria-label="Mask download menu"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu3="matMenu">
          <button mat-menu-item (click)="downloadImage(mask)">
            <mat-icon>image</mat-icon>
            <span>Download mask</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </ng-container>
</div>
<!--Fetched Masks-->

<div class="end-page"></div>
